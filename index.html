<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>One Word Imposter</title>
  <style>
    :root {
      --bg: #f5f7f4;
      --accent: #2d6a4f;
      --button-bg: #40916c;
      --text: #1a1a1a;
      --tile-bg: #ffffff;
      --tile-border: #e8ebe6;
      --muted: #6b7280;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    .header-hint {
      font-size: 28px;
      font-weight: 600;
      margin: 20px 0 30px;
      color: #333;
      text-align: center;
    }
    .app-frame {
      width: 100%;
      max-width: 420px;
      background: white;
      border-radius: 50px;
      padding: 40px 28px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.04);
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 700px;
    }
    .more-btn {
      position: absolute;
      top: 35px;
      right: 28px;
      background: #e8ebe6;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      font-weight: 700;
      color: #6b7280;
    }
    h1 {
      color: var(--accent);
      font-size: 30px;
      margin: 0 0 20px;
      font-weight: 800;
      letter-spacing: -0.8px;
      text-align: center;
    }
    .player-selector {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 20px;
      margin-bottom: 25px;
    }
    .arrow-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px 12px;
      color: #9ca3af;
      font-size: 22px;
      transition: color 0.2s;
    }
    .arrow-btn:active { color: var(--accent); }
    .player-count-display {
      font-size: 36px;
      font-weight: 800;
      display: flex;
      align-items: baseline;
      min-width: 100px;
      justify-content: center;
    }
    .player-count-display span {
      font-size: 16px;
      font-weight: 600;
      color: #6b7280;
      margin-left: 6px;
    }
    .category-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      width: 100%;
      margin-bottom: 20px;
    }
    .category-tile {
      background: white;
      border: 1px solid var(--tile-border);
      border-radius: 50%; /* Circles */
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 14px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.03);
      color: #333;
      line-height: 1.2;
    }
    .category-tile.active {
      border: 3.5px solid #000;
      transform: scale(1.15);
      z-index: 10;
      box-shadow: 0 15px 30px rgba(0,0,0,0.1);
      font-size: 14px;
      background: white;
    }
    .main-btn {
      width: 100%;
      background: var(--button-bg);
      color: white;
      border: none;
      border-radius: 24px;
      padding: 20px;
      font-size: 19px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.1s, opacity 0.2s;
      margin-top: auto;
    }
    .main-btn:active { transform: scale(0.97); opacity: 0.9; }
    
    .screen { width: 100%; display: none; height: 100%; flex-direction: column; align-items: center; }
    .screen.active { display: flex; }

    /* Rules Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 24px;
      backdrop-filter: blur(6px);
    }
    .modal.active { display: flex; }
    .modal-content {
      background: white;
      padding: 36px;
      border-radius: 35px;
      max-width: 440px;
      width: 100%;
      box-shadow: 0 30px 60px rgba(0,0,0,0.2);
    }
    .modal-content h3 { margin-top: 0; font-size: 24px; color: var(--accent); font-weight: 800; }
    .modal-content ol { padding-left: 20px; line-height: 1.7; color: #444; font-size: 16px; }
    .close-modal {
      width: 100%;
      padding: 16px;
      background: #e8ebe6;
      border: none;
      border-radius: 16px;
      margin-top: 25px;
      font-weight: 700;
      cursor: pointer;
    }

    /* Deal Screen */
    .deal-card {
      background: #fafbfc;
      border: 2px dashed #e5e7eb;
      border-radius: 50%; /* Circle card */
      width: 300px;
      height: 300px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 20px 0;
      padding: 30px;
      text-align: center;
      transition: all 0.3s ease;
    }
    .role-text { font-size: 32px; font-weight: 800; margin: 10px 0; color: var(--text); line-height: 1.1; }
    .role-sub { font-size: 15px; color: var(--muted); margin-bottom: 15px; }
    .pill-row { display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; justify-content: center; }
    .mini-pill { background: #e8ebe6; padding: 8px 16px; border-radius: 25px; font-size: 13px; font-weight: 700; color: #555; }
    
    .translation-controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
      width: 100%;
    }
    .lang-select {
      padding: 10px 16px;
      border-radius: 20px;
      border: 1px solid #e5e7eb;
      background: #f9f9f9;
      font-size: 14px;
      font-weight: 600;
      width: 180px;
      cursor: pointer;
    }
    .toggle-btn {
      background: none;
      border: 1px solid var(--accent);
      color: var(--accent);
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    .toggle-btn.on { background: var(--accent); color: white; }

    @media (max-width: 480px) {
      .app-frame { padding: 35px 20px; border-radius: 40px; min-height: 650px; }
      .category-grid { gap: 12px; }
      .category-tile { font-size: 12px; }
      .deal-card { width: 260px; height: 260px; }
      .role-text { font-size: 28px; }
      .more-btn { width: 26px; height: 26px; font-size: 14px; top: 30px; right: 20px; }
    }
  </style>
</head>
<body>
  <div class="header-hint" id="headerHint">Choose a category</div>

  <div class="app-frame">
    <button class="more-btn" id="rulesToggle">?</button>
    
    <!-- SETUP SCREEN -->
    <section id="setupScreen" class="screen active">
      <h1 id="appTitle">One Word Imposter</h1>
      
      <div class="player-selector">
        <button class="arrow-btn" id="playerDown">◀</button>
        <div class="player-count-display">
          <span id="playerVal">6</span> <span>Players</span>
        </div>
        <button class="arrow-btn" id="playerUp">▶</button>
      </div>

      <div class="category-grid" id="categoryGrid">
        <!-- Tiles generated by JS -->
      </div>

      <button class="main-btn" id="startBtn">Start Game</button>
    </section>

    <!-- DEAL SCREEN -->
    <section id="dealScreen" class="screen">
      <div class="pill-row">
        <div class="mini-pill" id="catPill">Category: –</div>
        <div class="mini-pill" id="langPill">EN</div>
      </div>
      
      <div class="deal-card" id="roleCard">
        <div class="role-text" id="cardTitle">Hidden</div>
        <div class="role-sub" id="cardSub">Pass the device to Player 1</div>
        <div id="cardExtra" style="font-weight:700; color:#888;">Player 1 / 6</div>
      </div>

      <button class="main-btn" id="revealBtn">Show role</button>
      <button class="main-btn" id="nextBtn" style="background:#e8ebe6; color:#333; margin-top:12px; display:none;">Next player</button>
      <button class="main-btn" id="backBtn" style="background:none; color:#6b7280; font-size:14px; margin-top:10px;">← Back to Setup</button>
    </section>

    <!-- SHARED TRANSLATION CONTROLS -->
    <div class="translation-controls" style="margin-top: 25px; border-top: 1px solid #f0f0f0; padding-top: 20px;">
      <select class="lang-select" id="setupLang">
        <option value="en">English (default)</option>
        <option value="zh-CN">Chinese (Simplified)</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>
        <option value="de">German</option>
        <option value="ja">Japanese</option>
        <option value="ko">Korean</option>
        <option value="ar">Arabic</option>
        <option value="hi">Hindi</option>
      </select>
      <button class="toggle-btn" id="setupTransToggle">Translate off</button>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modal" id="rulesModal">
    <div class="modal-content">
      <h3 id="rulesTitle">Rules</h3>
      <ol id="rulesList">
        <li data-i18n="rule1">One person is the imposter and doesn't know the word.</li>
        <li data-i18n="rule2">Everyone else knows the secret word.</li>
        <li data-i18n="rule3">Give one-word hints to prove you aren't the liar.</li>
        <li data-i18n="rule4">Discuss and vote to catch the imposter!</li>
      </ol>
      <h3 id="transHelperTitle" style="margin-top: 20px; font-size: 18px; color: var(--accent);">Translation Helper</h3>
      <p id="transHelperText" style="font-size: 14px; color: #666; line-height: 1.6; margin: 10px 0;">
        Select a language from the dropdown, then tap "Translate on" to see the entire UI and secret words in that language. 
        This helps players who prefer a different language. Toggle off anytime to return to English.
      </p>
      <button class="close-modal" id="closeRules">Got it</button>
    </div>
  </div>

  <script>
    const categories = {
      foods: ["pizza", "burger", "pasta", "sushi", "taco", "burrito", "ramen", "curry", "stew", "fried rice", "paella", "lasagna", "sandwich", "salad", "omelette", "pancakes", "waffles", "bagel", "doughnut", "quiche", "soup", "chowder", "risotto", "meatballs", "roast chicken", "steak", "barbecue ribs", "falafel", "hummus", "shawarma", "kebab", "gyro", "pita", "ceviche", "nachos", "enchilada", "quesadilla", "dumplings", "spring rolls", "bibimbap", "kimchi", "hotpot", "pho", "pad thai", "green curry", "butter chicken", "tandoori", "samosa", "pav bhaji", "pierogi", "gnocchi", "fajitas", "bruschetta", "ratatouille", "gazpacho", "poke bowl", "miso soup", "clam bake", "mac and cheese", "fried chicken"],
      fruits: ["apple", "banana", "orange", "mango", "pineapple", "strawberry", "blueberry", "raspberry", "blackberry", "cherry", "grape", "watermelon", "cantaloupe", "honeydew", "kiwi", "papaya", "guava", "lychee", "peach", "plum", "apricot", "nectarine", "pear", "pomegranate", "grapefruit", "tangerine", "clementine", "lime", "lemon", "coconut", "fig", "date", "persimmon", "dragonfruit", "starfruit", "passionfruit", "jackfruit", "durian", "cranberry", "boysenberry", "currant", "mulberry", "avocado", "olive", "tomato", "gooseberry", "elderberry", "sapodilla", "longan", "rambutan", "loquat", "soursop", "plantain", "mandarin", "blood orange", "tangelo", "ugli fruit", "quince", "sugar apple", "carambola"],
      sports: ["soccer", "basketball", "baseball", "softball", "football", "rugby", "cricket", "tennis", "table tennis", "badminton", "volleyball", "beach volleyball", "golf", "hockey", "ice hockey", "field hockey", "lacrosse", "handball", "water polo", "swimming", "diving", "surfing", "sailing", "rowing", "kayaking", "canoeing", "cycling", "mountain biking", "bmx", "track and field", "marathon", "triathlon", "wrestling", "boxing", "kickboxing", "martial arts", "judo", "karate", "taekwondo", "fencing", "archery", "shooting", "skateboarding", "snowboarding", "skiing", "cross-country skiing", "biathlon", "curling", "figure skating", "speed skating", "gymnastics", "cheerleading", "bowling", "darts", "billiards", "squash", "racquetball", "pickleball", "ultimate frisbee", "disc golf"],
      music: ["guitar", "piano", "violin", "cello", "viola", "double bass", "flute", "clarinet", "saxophone", "trumpet", "trombone", "french horn", "tuba", "drums", "percussion", "xylophone", "marimba", "ukulele", "banjo", "mandolin", "harp", "accordion", "harmonica", "synthesizer", "organ", "bass guitar", "microphone", "choir", "orchestra", "band", "duet", "solo", "chorus", "verse", "bridge", "hook", "melody", "harmony", "rhythm", "tempo", "beat", "scale", "chord", "arpeggio", "riff", "groove", "hip hop", "rock", "pop", "jazz", "blues", "country", "folk", "reggae", "salsa", "merengue", "bachata", "techno", "house", "classical"],
      highSchoolSubjects: ["algebra", "geometry", "trigonometry", "calculus", "statistics", "precalculus", "algebra 2", "biology", "chemistry", "physics", "earth science", "environmental science", "anatomy", "physiology", "computer science", "programming", "robotics", "engineering", "astronomy", "economics", "microeconomics", "macroeconomics", "world history", "us history", "government", "civics", "psychology", "sociology", "philosophy", "ethics", "english", "literature", "writing", "grammar", "creative writing", "journalism", "public speaking", "debate", "spanish", "french", "german", "chinese", "latin", "art", "drawing", "painting", "sculpture", "music", "choir", "band", "orchestra", "theater", "drama", "health", "physical education", "business", "accounting", "marketing", "entrepreneurship", "finance", "ap calculus", "ap biology", "ap chemistry", "ap physics", "ap statistics", "ap us history", "ap world history", "ap government", "ap psychology", "ap computer science"],
      geography: ["asia", "europe", "africa", "north america", "south america", "australia", "antarctica", "pacific ocean", "atlantic ocean", "indian ocean", "arctic ocean", "mediterranean sea", "caribbean sea", "gulf of mexico", "sahara desert", "gobi desert", "amazon river", "nile river", "yangtze river", "mississippi river", "mount everest", "andes mountains", "himalayas", "rocky mountains", "alps", "ural mountains", "great lakes", "lake baikal", "lake victoria", "grand canyon", "great barrier reef", "ganges river", "thames river", "danube river", "rhine river", "serengeti", "savanna", "taiga", "tundra", "rainforest", "steppe", "delta", "isthmus", "peninsula", "archipelago", "island", "strait", "fjord", "canyon", "plateau", "valley", "volcano", "glacier", "atoll", "lagoon", "monsoon", "typhoon", "equator", "prime meridian", "tropic of cancer", "tropic of capricorn", "cape"],
      jobs: ["doctor", "nurse", "surgeon", "paramedic", "pharmacist", "dentist", "veterinarian", "teacher", "professor", "principal", "software engineer", "product manager", "designer", "data scientist", "data analyst", "devops engineer", "systems administrator", "electrician", "plumber", "carpenter", "mechanic", "civil engineer", "architect", "lawyer", "judge", "paralegal", "police officer", "firefighter", "pilot", "flight attendant", "chef", "cook", "baker", "barista", "server", "bartender", "farmer", "rancher", "scientist", "researcher", "lab technician", "accountant", "auditor", "financial analyst", "banker", "investor", "real estate agent", "salesperson", "marketing manager", "social media manager", "journalist", "photographer", "videographer", "actor", "musician", "athlete", "coach", "fitness trainer", "therapist", "psychologist", "counselor", "translator", "interpreter", "delivery driver", "truck driver", "warehouse worker", "construction worker", "security guard", "cashier", "customer support"],
      history: ["ancient egypt", "mesopotamia", "indus valley", "ancient greece", "roman empire", "byzantine empire", "medieval europe", "renaissance", "age of exploration", "industrial revolution", "american revolution", "french revolution", "civil war", "world war i", "world war ii", "cold war", "fall of the berlin wall", "printing press", "magna carta", "black death", "reformation", "enlightenment", "great depression", "moon landing", "stone age", "bronze age", "iron age", "feudalism", "crusades", "ottoman empire", "mongol empire", "mughal empire", "qing dynasty", "han dynasty", "song dynasty", "tokugawa shogunate", "aztec empire", "maya civilization", "inca empire", "viking age", "age of sail", "silk road", "spice trade", "colonial america", "gold rush", "civil rights movement", "women's suffrage", "space race", "digital revolution", "rise of the internet", "arab spring", "industrial age steam", "railroad expansion", "telegraph invention", "telephone invention", "radio era", "television era", "nuclear age", "exploration of antarctica", "apollo program"],
      humanBody: ["head", "skull", "brain", "face", "eye", "eyebrow", "eyelash", "ear", "nose", "mouth", "tongue", "tooth", "teeth", "lip", "jaw", "neck", "shoulder", "arm", "elbow", "wrist", "hand", "finger", "thumb", "palm", "chest", "rib", "heart", "lung", "stomach", "liver", "kidney", "spleen", "pancreas", "intestine", "bladder", "spine", "back", "hip", "pelvis", "leg", "thigh", "knee", "calf", "ankle", "foot", "heel", "toe", "skin", "muscle", "bone", "blood", "artery", "vein", "nerve", "tendon", "ligament", "cartilage", "hair", "nail", "immune system", "lymph node", "diaphragm", "esophagus", "trachea", "larynx", "pharynx"],
      household: ["sofa", "couch", "chair", "armchair", "recliner", "table", "coffee table", "dining table", "desk", "bookshelf", "bed", "mattress", "pillow", "blanket", "duvet", "sheet", "nightstand", "lamp", "floor lamp", "ceiling fan", "tv", "remote control", "router", "modem", "speaker", "headphones", "clock", "mirror", "curtain", "blinds", "rug", "carpet", "doormat", "trash can", "recycling bin", "vacuum", "broom", "mop", "bucket", "spray bottle", "dish soap", "sponge", "dishwasher", "sink", "faucet", "oven", "stove", "microwave", "toaster", "fridge", "freezer", "kettle", "coffee maker", "blender", "cutting board", "knife", "fork", "spoon", "plate", "bowl", "cup", "mug", "napkin", "towel", "laundry basket", "hanger", "closet", "drawer", "cabinet", "pantry"],
      nature: ["mountain", "river", "lake", "ocean", "sea", "waterfall", "glacier", "volcano", "desert", "forest", "jungle", "rainforest", "savanna", "canyon", "valley", "meadow", "prairie", "dune", "cliff", "cave", "coral reef", "island", "archipelago", "peninsula", "delta", "estuary", "lagoon", "bay", "fjord", "geyser", "hot spring", "iceberg", "aurora", "thunderstorm", "lightning", "rainbow", "eclipse", "hurricane", "tornado", "blizzard", "monsoon", "snowfall", "sunrise", "sunset", "tide", "wave", "oasis", "plateau", "butte", "mesa", "hill", "peak", "ridge", "wetland", "marsh", "swamp", "bog", "mangrove", "steppe", "taiga"],
      animals: ["dog", "cat", "horse", "cow", "sheep", "goat", "pig", "chicken", "duck", "goose", "turkey", "rabbit", "deer", "moose", "elk", "yak", "camel", "llama", "alpaca", "donkey", "zebra", "giraffe", "elephant", "rhinoceros", "hippopotamus", "lion", "tiger", "leopard", "cheetah", "panther", "bear", "panda", "koala", "kangaroo", "wallaby", "opossum", "sloth", "armadillo", "anteater", "crocodile", "alligator", "turtle", "tortoise", "snake", "lizard", "chameleon", "frog", "toad", "salamander", "dolphin", "whale", "shark", "octopus", "squid", "crab", "lobster", "penguin", "eagle", "owl", "fox"],
      famousPeople: ["albert einstein", "marie curie", "leonardo da vinci", "william shakespeare", "cleopatra", "napoleon bonaparte", "mahatma gandhi", "martin luther king jr", "nelson mandela", "abraham lincoln", "queen elizabeth ii", "princess diana", "michael jackson", "elvis presley", "the beatles", "madonna", "beyonce", "taylor swift", "oprah winfrey", "steve jobs", "bill gates", "elon musk", "mark zuckerberg", "jeff bezos", "barack obama", "donald trump", "joe biden", "pablo picasso", "vincent van gogh", "frida kahlo", "michael jordan", "lebron james", "serena williams", "usain bolt", "muhammad ali", "cristiano ronaldo", "lionel messi", "tom hanks", "meryl streep", "tom cruise", "brad pitt", "angelina jolie", "marilyn monroe", "charlie chaplin", "walt disney", "stephen hawking", "nikola tesla", "isaac newton", "charles darwin", "mother teresa", "dalai lama", "pope francis", "j.k. rowling", "stephen king", "ernest hemingway", "mark twain", "beethoven", "mozart", "bach", "bruce lee"],
      countries: ["united states", "canada", "mexico", "brazil", "argentina", "united kingdom", "france", "germany", "italy", "spain", "portugal", "russia", "china", "japan", "south korea", "india", "australia", "new zealand", "egypt", "south africa", "nigeria", "kenya", "morocco", "turkey", "greece", "poland", "ukraine", "sweden", "norway", "finland", "denmark", "netherlands", "belgium", "switzerland", "austria", "ireland", "scotland", "thailand", "vietnam", "indonesia", "philippines", "malaysia", "singapore", "saudi arabia", "israel", "iran", "pakistan", "bangladesh", "colombia", "peru", "chile", "cuba", "jamaica", "iceland", "portugal", "czech republic", "hungary", "romania", "croatia", "serbia"],
      clothes: ["t-shirt", "jeans", "dress", "skirt", "blouse", "sweater", "hoodie", "jacket", "coat", "blazer", "suit", "tuxedo", "shorts", "pants", "leggings", "cardigan", "vest", "tank top", "polo shirt", "button-down shirt", "sweatpants", "joggers", "overalls", "jumpsuit", "romper", "sundress", "cocktail dress", "evening gown", "wedding dress", "pajamas", "robe", "underwear", "socks", "stockings", "scarf", "hat", "beanie", "cap", "gloves", "mittens", "belt", "tie", "bow tie", "sneakers", "boots", "heels", "sandals", "flip flops", "loafers", "oxfords", "slippers", "raincoat", "windbreaker", "parka", "trench coat", "denim jacket", "leather jacket", "peacoat", "swimsuit", "bikini"],
      famousCompanies: ["apple", "google", "microsoft", "amazon", "facebook", "netflix", "tesla", "spacex", "nvidia", "samsung", "sony", "nintendo", "disney", "warner bros", "universal", "paramount", "coca-cola", "pepsi", "mcdonald's", "starbucks", "nike", "adidas", "toyota", "honda", "ford", "bmw", "mercedes-benz", "volkswagen", "ferrari", "porsche", "boeing", "airbus", "ibm", "intel", "amd", "oracle", "salesforce", "adobe", "spotify", "twitter", "snapchat", "tiktok", "uber", "airbnb", "walmart", "target", "costco", "ikea", "h&m", "zara", "uniqlo", "lego", "hasbro", "mattel", "johnson & johnson", "pfizer", "moderna", "visa", "mastercard", "paypal"],
      fashionBrands: ["gucci", "louis vuitton", "chanel", "prada", "versace", "dior", "armani", "burberry", "balenciaga", "givenchy", "fendi", "valentino", "yves saint laurent", "hermes", "cartier", "tiffany", "rolex", "omega", "tag heuer", "calvin klein", "ralph lauren", "tommy hilfiger", "michael kors", "coach", "kate spade", "marc jacobs", "dolce & gabbana", "bottega veneta", "alexander mcqueen", "stella mccartney", "off-white", "supreme", "bape", "fear of god", "stone island", "moncler", "canada goose", "the north face", "patagonia", "lululemon", "nike", "adidas", "puma", "new balance", "converse", "vans", "reebok", "under armour", "champion", "fila", "lacoste", "hugo boss", "zegna", "brunello cucinelli", "loro piana", "salvatore ferragamo", "tod's", "jimmy choo", "manolo blahnik", "christian louboutin"]
    };

    const state = {
      players: 6,
      category: "random",
      word: null,
      liarIndex: null,
      currentPlayer: 1,
      activeScreen: "setup",
      cardMode: "hidden",
      translationEnabled: false,
      targetLang: "en",
      cache: {}
    };

    const elements = {
      playerVal: document.getElementById("playerVal"),
      playerUp: document.getElementById("playerUp"),
      playerDown: document.getElementById("playerDown"),
      categoryGrid: document.getElementById("categoryGrid"),
      startBtn: document.getElementById("startBtn"),
      setupScreen: document.getElementById("setupScreen"),
      dealScreen: document.getElementById("dealScreen"),
      catPill: document.getElementById("catPill"),
      langPill: document.getElementById("langPill"),
      cardTitle: document.getElementById("cardTitle"),
      cardSub: document.getElementById("cardSub"),
      cardExtra: document.getElementById("cardExtra"),
      revealBtn: document.getElementById("revealBtn"),
      nextBtn: document.getElementById("nextBtn"),
      backBtn: document.getElementById("backBtn"),
      rulesToggle: document.getElementById("rulesToggle"),
      rulesModal: document.getElementById("rulesModal"),
      closeRules: document.getElementById("closeRules"),
      headerHint: document.getElementById("headerHint"),
      appTitle: document.getElementById("appTitle"),
      setupLang: document.getElementById("setupLang"),
      setupTransToggle: document.getElementById("setupTransToggle")
    };

    function prettyName(key) {
      if (key === "random") return "Random";
      if (key === "highSchoolSubjects") return "High school subjects";
      if (key === "humanBody") return "Human body";
      if (key === "famousPeople") return "Famous people";
      if (key === "famousCompanies") return "Famous companies";
      if (key === "fashionBrands") return "Fashion brands";
      return key.charAt(0).toUpperCase() + key.slice(1);
    }

    // All UI strings that need translation
    const uiStrings = [
      "Choose a category", "One Word Imposter", "Start Game", "← Back to Setup",
      "Rules", "Got it", "Translate on", "Translate off", "Category", "Random",
      "Hidden", "Pass the device to Player", "Show role", "Ready!",
      "Discuss and find the liar", "You are the LIAR!", "Listen for clues and blend in",
      "You know the secret word", "Next player", "Player", "Players",
      "One person is the imposter and doesn't know the word.",
      "Everyone else knows the secret word.",
      "Give one-word hints to prove you aren't the liar.",
      "Discuss and vote to catch the imposter!",
      "Translation Helper",
      "Select a language from the dropdown, then tap \"Translate on\" to see the entire UI and secret words in that language. This helps players who prefer a different language. Toggle off anytime to return to English.",
      "Foods", "Fruits", "Sports", "Music", "High school subjects", "Geography",
      "Jobs", "History", "Human body", "Household", "Nature", "Animals",
      "Famous people", "Countries", "Clothes", "Famous companies", "Fashion brands"
    ];

    // Translate a single string (with caching)
    async function translateOne(text, lang) {
      const cacheKey = `${lang}:${text}`;
      if (state.cache[cacheKey]) return state.cache[cacheKey];
      
      try {
        const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=${lang}&dt=t&q=${encodeURIComponent(text)}`);
        const data = await res.json();
        const result = data[0][0][0];
        state.cache[cacheKey] = result;
        return result;
      } catch (e) {
        console.error("Translation failed for:", text, e);
        return text;
      }
    }

    // Pre-load all UI translations when language changes (parallel requests)
    async function preloadTranslations() {
      if (state.targetLang === "en") return;
      
      // Collect all strings to translate
      const allStrings = [...uiStrings];
      Object.keys(categories).forEach(k => allStrings.push(prettyName(k)));
      if (state.word) allStrings.push(state.word);
      
      // Filter out already cached
      const uncached = allStrings.filter(s => !state.cache[`${state.targetLang}:${s}`]);
      
      // Translate ALL uncached strings in PARALLEL
      await Promise.all(uncached.map(s => translateOne(s, state.targetLang)));
    }

    // Get translation from cache (instant) or return original
    function t(text) {
      if (!state.translationEnabled || state.targetLang === "en") return text;
      return state.cache[`${state.targetLang}:${text}`] || text;
    }

    function applyTranslations() {
      const set = (el, text) => { if (el) el.textContent = text; };

      // Update toggle button immediately
      elements.setupTransToggle.textContent = state.translationEnabled ? t("Translate on") : t("Translate off");
      elements.setupTransToggle.classList.toggle("on", state.translationEnabled);

      // All static UI elements - instant from cache
      set(elements.headerHint, t("Choose a category"));
      set(elements.appTitle, t("One Word Imposter"));
      set(elements.startBtn, t("Start Game"));
      set(elements.backBtn, t("← Back to Setup"));
      set(document.getElementById("rulesTitle"), t("Rules"));
      set(document.getElementById("closeRules"), t("Got it"));
      
      // Category tiles
      document.querySelectorAll(".category-tile").forEach(tile => {
        const raw = tile.getAttribute("data-raw");
        set(tile, t(raw));
      });

      // Rules list
      const baseRules = [
        "One person is the imposter and doesn't know the word.",
        "Everyone else knows the secret word.",
        "Give one-word hints to prove you aren't the liar.",
        "Discuss and vote to catch the imposter!"
      ];
      document.querySelectorAll("#rulesList li").forEach((li, i) => {
        set(li, t(baseRules[i]));
      });
      
      // Translation helper section
      set(document.getElementById("transHelperTitle"), t("Translation Helper"));
      set(document.getElementById("transHelperText"), t("Select a language from the dropdown, then tap \"Translate on\" to see the entire UI and secret words in that language. This helps players who prefer a different language. Toggle off anytime to return to English."));
      
      // Deal screen
      if (state.activeScreen === "deal") {
        const catName = state.category === "random" ? "Random" : prettyName(state.category);
        set(elements.catPill, `${t("Category")}: ${t(catName)}`);
        set(elements.langPill, state.targetLang.toUpperCase());
        renderCard();
      }
    }

    function renderCard(mode) {
      if (mode) state.cardMode = mode;
      const m = state.cardMode;
      const set = (el, text) => { if (el) el.textContent = text; };

      set(elements.cardExtra, `${t("Player")} ${state.currentPlayer} / ${state.players}`);

      if (m === "hidden") {
        set(elements.cardTitle, t("Hidden"));
        set(elements.cardSub, `${t("Pass the device to Player")} ${state.currentPlayer}`);
        elements.revealBtn.style.display = "block";
        elements.nextBtn.style.display = "none";
        set(elements.revealBtn, t("Show role"));
      } else if (m === "ready") {
        set(elements.cardTitle, t("Ready!"));
        set(elements.cardSub, t("Discuss and find the liar"));
        elements.revealBtn.style.display = "none";
        elements.nextBtn.style.display = "none";
      } else {
        const isLiar = state.currentPlayer === state.liarIndex;
        if (isLiar) {
          set(elements.cardTitle, t("You are the LIAR!"));
          set(elements.cardSub, t("Listen for clues and blend in"));
        } else {
          set(elements.cardTitle, t(state.word));
          set(elements.cardSub, t("You know the secret word"));
        }
        elements.revealBtn.style.display = "none";
        elements.nextBtn.style.display = "block";
        set(elements.nextBtn, t("Next player"));
      }
    }

    function init() {
      const keys = ["random", ...Object.keys(categories)];
      elements.categoryGrid.innerHTML = "";
      keys.forEach(k => {
        const tile = document.createElement("div");
        tile.className = `category-tile ${k === state.category ? "active" : ""}`;
        tile.setAttribute("data-raw", prettyName(k));
        tile.textContent = prettyName(k);
        tile.onclick = () => {
          state.category = k;
          document.querySelectorAll(".category-tile").forEach(t => t.classList.remove("active"));
          tile.classList.add("active");
        };
        elements.categoryGrid.appendChild(tile);
      });

      elements.playerUp.onclick = () => { if (state.players < 20) { state.players++; elements.playerVal.textContent = state.players; } };
      elements.playerDown.onclick = () => { if (state.players > 3) { state.players--; elements.playerVal.textContent = state.players; } };
      
      elements.startBtn.onclick = startGame;
      elements.revealBtn.onclick = () => renderCard("shown");
      elements.nextBtn.onclick = () => {
        if (state.currentPlayer < state.players) {
          state.currentPlayer++;
          renderCard("hidden");
        } else {
          renderCard("ready");
        }
      };
      elements.backBtn.onclick = () => { 
        state.activeScreen = "setup";
        elements.setupScreen.classList.add("active");
        elements.dealScreen.classList.remove("active");
        elements.headerHint.style.display = "block";
        state.currentPlayer = 1;
        applyTranslations();
      };
      
      elements.rulesToggle.onclick = () => elements.rulesModal.classList.add("active");
      elements.closeRules.onclick = () => elements.rulesModal.classList.remove("active");
      
      // When language changes: preload translations in background
      elements.setupLang.onchange = async (e) => { 
        state.targetLang = e.target.value; 
        await preloadTranslations();
        if (state.translationEnabled) applyTranslations();
      };
      
      // Toggle - preload if needed, then apply instantly
      elements.setupTransToggle.onclick = async () => { 
        state.translationEnabled = !state.translationEnabled;
        if (state.translationEnabled && state.targetLang !== "en") {
          await preloadTranslations();
        }
        applyTranslations(); 
      };

      applyTranslations();
    }

    async function startGame() {
      let finalCat = state.category;
      if (finalCat === "random") {
        const keys = Object.keys(categories);
        finalCat = keys[Math.floor(Math.random() * keys.length)];
      }
      state.chosenCategory = finalCat;
      const wordList = categories[finalCat];
      state.word = wordList[Math.floor(Math.random() * wordList.length)];
      state.liarIndex = Math.floor(Math.random() * state.players) + 1;
      state.currentPlayer = 1;
      
      // Pre-translate the word if translation is on
      if (state.translationEnabled && state.targetLang !== "en") {
        await translateOne(state.word, state.targetLang);
      }
      
      state.activeScreen = "deal";
      elements.setupScreen.classList.remove("active");
      elements.dealScreen.classList.add("active");
      elements.headerHint.style.display = "none";
      
      renderCard("hidden");
      applyTranslations();
    }

    init();
  </script>
</body>
</html>
